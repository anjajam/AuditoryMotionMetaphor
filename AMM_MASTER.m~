%% AMM MASTER SCRIPT
% This script will process the data for the auditory motion metaphor study
%
% Written by Anja Jamrozik and Andrew S Bock Aug 2016


%% Set up initial variables
dataDir = '/data/jag/ajamrozik/Data/AMMet/';
subjDirs = listdir(dataDir,'dirs');
SUBJECTS_DIR = getenv('SUBJECT_DIR');
shellScriptDir = '/data/jag/ajamrozik/clusterscripts/AMMet/reconallScripts';
if ~exist(shellScriptDir,'dir')
   mkd 
end
%% Sort the dicoms and convert to nifti

%%%% add these scripts %%%%

%% Run Freesurfer's recon-all
% We ran some of the subjects already, so we just want to run the remained
fsSubs = listdir(SUBJECTS_DIR,'dir');
for i = 1:length(subjDirs)
    if ~ismember(subjDirs{i},fsSubs)
        sessDir = listdir(subDir{i},'dirs');
        % make a recon-all shell script
        inAnat = fullfile(dataDir,subjDirs{i},sessDir{1},'MPRAGE/001/ACPC/MPRAGE.ACPC.nii.gz');
        reconallText = ['recon-all -i ' inAnat ' -s ' sessDir{1} ' -all'];
        fname = fullfile(outDir,[job_name '_anatomical.sh']);
        fid = fopen(fname,'w');
        fprintf(fid,['matlab -nodisplay -nosplash -r ' matlab_string])
        fclose(fid);
    end
end
% make a submit script

%% Anything else we did

%%% e.g. slice timing correction? %%%

%%% e.g. Joe's scripts %%% this could just be a description, or a link to
%%% the python scripts

%%% feat stuff %%%

%% Register the functional data to the freesurfer anatomical data
% Use Freesurfer's 'bbregister' function

for i = 1:length(subjDirs)
    subDir = fullfile(dataDir,subjDirs{i});
    sessDir = listdir(subDir,'dirs');
    
    bbregister(subject_name,filefor_reg,bbreg_out_file,acq_type);
end


